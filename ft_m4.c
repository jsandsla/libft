/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_m4.c                                            :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: jsandsla <jsandsla@student.21-school.ru>   +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2020/11/26 13:19:37 by jsandsla          #+#    #+#             */
/*   Updated: 2020/12/07 17:27:05 by jsandsla         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "libft.h"

#define M(l1,l2,r1,r2) l[l1][l2] * r[r1][r2]

void	ft_mul_m4_to(t_m4 l, t_m4 r, t_m4 out)
{
	out[0][0] = M(0, 0, 0, 0) + M(1, 0, 0, 1) + M(2, 0, 0, 2) + M(3, 0, 0, 3);
	out[0][1] = M(0, 1, 0, 0) + M(1, 1, 0, 1) + M(2, 1, 0, 2) + M(3, 1, 0, 3);
	out[0][2] = M(0, 2, 0, 0) + M(1, 2, 0, 1) + M(2, 2, 0, 2) + M(3, 2, 0, 3);
	out[0][3] = M(0, 3, 0, 0) + M(1, 3, 0, 1) + M(2, 3, 0, 2) + M(3, 3, 0, 3);
	out[1][0] = M(0, 0, 1, 0) + M(1, 0, 1, 1) + M(2, 0, 1, 2) + M(3, 0, 1, 3);
	out[1][1] = M(0, 1, 1, 0) + M(1, 1, 1, 1) + M(2, 1, 1, 2) + M(3, 1, 1, 3);
	out[1][2] = M(0, 2, 1, 0) + M(1, 2, 1, 1) + M(2, 2, 1, 2) + M(3, 2, 1, 3);
	out[1][3] = M(0, 3, 1, 0) + M(1, 3, 1, 1) + M(2, 3, 1, 2) + M(3, 3, 1, 3);
	out[2][0] = M(0, 0, 2, 0) + M(1, 0, 2, 1) + M(2, 0, 2, 2) + M(3, 0, 2, 3);
	out[2][1] = M(0, 1, 2, 0) + M(1, 1, 2, 1) + M(2, 1, 2, 2) + M(3, 1, 2, 3);
	out[2][2] = M(0, 2, 2, 0) + M(1, 2, 2, 1) + M(2, 2, 2, 2) + M(3, 2, 2, 3);
	out[2][3] = M(0, 3, 2, 0) + M(1, 3, 2, 1) + M(2, 3, 2, 2) + M(3, 3, 2, 3);
	out[3][0] = M(0, 0, 3, 0) + M(1, 0, 3, 1) + M(2, 0, 3, 2) + M(3, 0, 3, 3);
	out[3][1] = M(0, 1, 3, 0) + M(1, 1, 3, 1) + M(2, 1, 3, 2) + M(3, 1, 3, 3);
	out[3][2] = M(0, 2, 3, 0) + M(1, 2, 3, 1) + M(2, 2, 3, 2) + M(3, 2, 3, 3);
	out[3][3] = M(0, 3, 3, 0) + M(1, 3, 3, 1) + M(2, 3, 3, 2) + M(3, 3, 3, 3);
}

void	ft_mul_m4rot_to(t_m4 l, t_m3 r, t_m4 out)
{
	out[0][0] = M(0, 0, 0, 0) + M(1, 0, 0, 1) + M(2, 0, 0, 2);
	out[0][1] = M(0, 1, 0, 0) + M(1, 1, 0, 1) + M(2, 1, 0, 2);
	out[0][2] = M(0, 2, 0, 0) + M(1, 2, 0, 1) + M(2, 2, 0, 2);
	out[0][3] = M(0, 3, 0, 0) + M(1, 3, 0, 1) + M(2, 3, 0, 2);
	out[1][0] = M(0, 0, 1, 0) + M(1, 0, 1, 1) + M(2, 0, 1, 2);
	out[1][1] = M(0, 1, 1, 0) + M(1, 1, 1, 1) + M(2, 1, 1, 2);
	out[1][2] = M(0, 2, 1, 0) + M(1, 2, 1, 1) + M(2, 2, 1, 2);
	out[1][3] = M(0, 3, 1, 0) + M(1, 3, 1, 1) + M(2, 3, 1, 2);
	out[2][0] = M(0, 0, 2, 0) + M(1, 0, 2, 1) + M(2, 0, 2, 2);
	out[2][1] = M(0, 1, 2, 0) + M(1, 1, 2, 1) + M(2, 1, 2, 2);
	out[2][2] = M(0, 2, 2, 0) + M(1, 2, 2, 1) + M(2, 2, 2, 2);
	out[2][3] = M(0, 3, 2, 0) + M(1, 3, 2, 1) + M(2, 3, 2, 2);
	out[3][0] = l[3][0];
	out[3][1] = l[3][1];
	out[3][2] = l[3][2];
	out[3][3] = l[3][3];
}

#undef M
#define M(l1,l2,r1) l[l1][l2] * r[r1]

void	ft_mul_vm4_to(t_m4 l, t_v4 r, t_v4 out)
{
	out[0] = M(0, 0, 0) + M(1, 0, 1) + M(2, 0, 2) + M(3, 0, 3);
	out[1] = M(0, 1, 0) + M(1, 1, 1) + M(2, 1, 2) + M(3, 1, 3);
	out[2] = M(0, 2, 0) + M(1, 2, 1) + M(2, 2, 2) + M(3, 2, 3);
	out[3] = M(0, 3, 0) + M(1, 3, 1) + M(2, 3, 2) + M(3, 3, 3);
}

#undef M

float	ft_mul_v3m4(t_m4 l, t_v3 r, float f3, t_v3 out)
{
	t_v4	in4;
	t_v4	out4;

	in4[0] = r[0];
	in4[1] = r[1];
	in4[2] = r[2];
	in4[3] = f3;
	ft_mul_vm4_to(l, in4, out4);
	out[0] = out4[0];
	out[1] = out4[1];
	out[2] = out4[2];
	return (out4[3]);
}

void	ft_persp_mul_v3m4(t_m4 l, t_v3 r, float f3, t_v3 out)
{
	t_v4	in4;
	t_v4	out4;

	in4[0] = r[0];
	in4[1] = r[1];
	in4[2] = r[2];
	in4[3] = f3;
	ft_mul_vm4_to(l, in4, out4);
	out[0] = out4[0] / out4[3];
	out[1] = out4[1] / out4[3];
	out[2] = out4[2] / out4[3];
}
